<style>
    .timeline-page {
        max-width: 1400px;
        margin: 0 auto;
        padding: 2rem;
    }

    .map-section {
        background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
        color: white;
        padding: 2rem;
        border-radius: 30px 30px 0 0;
        text-align: center;
    }

    .map-title {
        font-size: 2rem;
        font-family: var(--font-display);
        margin-bottom: 1rem;
        text-transform: uppercase;
        letter-spacing: 0.1em;
    }

    .map-container {
        height: 600px;
        background: white;
        border-radius: 0 0 30px 30px;
        overflow: hidden;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        border: 1px solid #ddd;
    }

    /* Vintage Popup Styles */
    .leaflet-popup-content-wrapper {
        background: #fffaf0;
        border-radius: 4px;
        box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.3);
        border: 2px solid #8b0000;
        padding: 0;
    }

    .leaflet-popup-content {
        margin: 0 !important;
        width: 300px !important;
    }

    .vintage-popup {
        padding: 1rem;
        font-family: var(--font-body);
    }

    .popup-header {
        border-bottom: 2px double #8b0000;
        margin-bottom: 0.5rem;
        padding-bottom: 0.5rem;
    }

    .popup-location {
        font-family: var(--font-display);
        font-size: 1.1rem;
        color: #8b0000;
        font-weight: 700;
        text-transform: uppercase;
    }

    .popup-date {
        font-size: 0.8rem;
        font-style: italic;
        color: #555;
    }

    .popup-title {
        font-size: 1rem;
        font-weight: 800;
        margin-bottom: 0.5rem;
        line-height: 1.3;
    }

    .popup-impact {
        margin-top: 0.5rem;
        padding-top: 0.5rem;
        border-top: 1px dashed #ccc;
        font-weight: 700;
        font-size: 0.85rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    /* Timeline Styling */
    .timeline-section {
        margin-top: 4rem;
    }

    .timeline-header {
        text-align: center;
        margin-bottom: 3rem;
    }

    .timeline-line-container {
        position: relative;
        padding: 2rem 0;
    }

    .timeline-line {
        position: absolute;
        left: 50%;
        top: 0;
        bottom: 0;
        width: 4px;
        background: linear-gradient(to bottom, #dc2626, #16a34a, #2563eb);
        transform: translateX(-50%);
    }

    .timeline-item {
        position: relative;
        margin-bottom: 4rem;
        display: flex;
        align-items: center;
        gap: 2rem;
        opacity: 0;
        transform: translateY(20px);
        animation: fadeInUp 0.6s forwards;
    }

    @keyframes fadeInUp {
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .timeline-item:nth-child(even) {
        flex-direction: row-reverse;
    }

    .timeline-content {
        flex: 1;
        background: white;
        padding: 2rem;
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        border-left: 6px solid #8b0000;
        transition: transform 0.3s;
    }

    .timeline-item:nth-child(even) .timeline-content {
        border-left: none;
        border-right: 6px solid #8b0000;
        text-align: right;
    }

    .timeline-content:hover {
        transform: scale(1.02);
    }

    .timeline-content h3 {
        font-family: var(--font-display);
        font-size: 1.5rem;
        margin-bottom: 0.5rem;
        color: #1e293b;
    }

    .timeline-marker {
        width: 60px;
        height: 60px;
        background: white;
        border-radius: 50%;
        border: 4px solid #8b0000;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: #8b0000;
        box-shadow: 0 0 0 6px rgba(255, 255, 255, 0.8);
        z-index: 2;
    }

    .timeline-date-badge {
        display: inline-block;
        background: #8b0000;
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 4px;
        font-size: 0.85rem;
        font-weight: 700;
        margin-bottom: 0.75rem;
    }
</style>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<div class="timeline-page">
    <!-- Map Section -->
    <div class="map-section">
        <i class="fas fa-map-marked-alt" style="font-size: 3rem; margin-bottom: 1rem;"></i>
        <h1 class="map-title">Milli Mücadele Haber Haritası</h1>
        <p style="opacity: 0.9;">İstikbal Gazetesi'nde yer alan haberlerin coğrafi dağılımı ve etki alanları</p>
    </div>
    <div class="map-container" id="map"></div>

    <!-- Timeline Section -->
    <div class="timeline-section">
        <div class="timeline-header">
            <h2 class="map-title text-3xl font-bold" style="color: var(--vintage-red);">Kronolojik Haber Akışı
                (1918-1923)</h2>
        </div>

        <div class="timeline-line-container" id="timeline-list">
            <div class="timeline-line"></div>
            <!-- Timeline items will be injected via JS -->
        </div>
    </div>
</div>

<script>
    (async function () {
        // Initialize Map
        const map = L.map('map').setView([39.5, 35.0], 6);

        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; OpenStreetMap contributors &copy; CARTO',
            maxZoom: 19
        }).addTo(map);

        // Load News Data
        try {
            const response = await fetch('../data/news.json');
            const data = await response.json();
            const newsList = data.archive;

            // Add markers to map
            newsList.forEach(news => {
                const marker = L.marker([news.lat, news.lng]).addTo(map);

                // Color code impact
                let impactColor = '#dc2626';
                if (news.impact >= 98) impactColor = '#16a34a'; // Green for high impact
                else if (news.impact >= 90) impactColor = '#2563eb'; // Blue

                marker.bindPopup(`
                    <div class="vintage-popup">
                        <div class="popup-header">
                            <div class="popup-location">${news.location}</div>
                            <div class="popup-date">${news.date}</div>
                        </div>
                        <div class="popup-title">${news.title}</div>
                        <p style="font-size: 0.9rem; line-height: 1.4;">${news.content.substring(0, 80)}...</p>
                        <div class="popup-impact">
                            <span>Milli Etki:</span>
                            <span style="color: ${impactColor}; font-size: 1.2rem;">%${news.impact}</span>
                        </div>
                    </div>
                `);
            });

            // Render Timeline Items
            const timelineContainer = document.getElementById('timeline-list');

            // Sort by ID (usually chronological)
            const sortedNews = newsList.sort((a, b) => a.id - b.id);

            sortedNews.forEach((news, index) => {
                let icon = 'fa-newspaper';
                if (news.category === 'ZAFER') icon = 'fa-trophy';
                if (news.category === 'ASKERİ') icon = 'fa-shield-alt';
                if (news.category === 'MATEM') icon = 'fa-fist-raised';

                const html = `
                    <div class="timeline-item" style="animation-delay: ${index * 0.1}s">
                        <div class="timeline-content">
                            <span class="timeline-date-badge">${news.date}</span>
                            <h3>${news.title}</h3>
                            <p>${news.content}</p>
                        </div>
                        <div class="timeline-marker">
                            <i class="fas ${icon}"></i>
                        </div>
                    </div>
                `;
                timelineContainer.innerHTML += html;
            });

        } catch (error) {
            console.error('Timeline error:', error);
        }
    })();
</script>